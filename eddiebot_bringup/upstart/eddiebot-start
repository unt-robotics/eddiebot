#!/bin/bash
# this file is generated by eddiebot_bringup/upstart/install.bash

log_file=/tmp/eddiebot-upstart.log
DATE=`date`

if [ -s /etc/ros/setup.bash ]; then
    echo "$DATE: eddiebot-start using setup file /etc/ros/setup.bash" >> $log_file
    source /etc/ros/setup.bash
else
    echo "$DATE: eddiebot-start using setup file /opt/ros/fuerte/setup.bash" >> $log_file
    source /opt/ros/fuerte/setup.bash
fi

interface=wlan0
echo "$DATE: eddiebot-start on interface $interface" >> $log_file

export ROS_IP=`ifconfig $interface | grep -o 'inet addr:[^ ]*' | cut -d: -f2`

echo "$DATE: eddiebot-start setting ROS_IP=$ROS_IP" >> $log_file

if [ "$ROS_IP" = "" ]; then
    echo "$DATE: eddiebot-start can't run with empty ROS_IP." >> $log_file
    exit 1
fi

if [ -s /etc/ros/fuerte/eddiebot.launch ]; then
    setuidgid eddiebot roslaunch /etc/ros/fuerte/eddiebot.launch
else
    setuidgid eddiebot roslaunch eddiebot_bringup minimal.launch
fi
